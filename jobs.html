{% extends "base.html" %}

{% block title %}Jobs â€” Toxicity Detector{% endblock %}

{% block content %}
<section class="card">
  <h2>Jobs</h2>
  <p class="muted">Background jobs started by the dashboard (downloads, spark jobs, training).</p>
  <div class="actions">
    <button id="refresh-jobs" class="btn">Refresh</button>
  </div>
  <div id="jobs-panel" style="margin-top:12px"></div>
  <pre id="job-log" class="log"></pre>
</section>

<script>
async function refreshJobs(){
  const res = await fetch('/api/jobs');
  const js = await res.json();
  const panel = document.getElementById('jobs-panel'); panel.innerHTML='';
  for(const j of js.jobs){
    const d = document.createElement('div'); d.className='job';
    d.innerHTML = `<strong>${j.id}</strong> - ${j.status} - ${j.type} - <button data-log='${j.log}' class='btn view-log'>View Log</button>`;
    panel.appendChild(d);
  }
  document.querySelectorAll('.view-log').forEach(b=>b.addEventListener('click', async e=>{
    const p = e.target.dataset.log;
    const r = await fetch('/api/log?path='+encodeURIComponent(p));
    const js = await r.json();
    document.getElementById('job-log').textContent = js.content || 'no log';
  }));
}
document.getElementById('refresh-jobs').addEventListener('click', refreshJobs);
refreshJobs();
</script>

{% endblock %}
