{% extends "base.html" %}

{% block title %}Models â€” Toxicity Detector{% endblock %}

{% block content %}
<section class="card">
  <h2>Models</h2>
  <p class="muted">List of trained Spark models available in the <code>models/</code> folder.</p>
  <div class="actions">
    <button id="refresh-models" class="btn">Refresh</button>
  </div>
  <div id="models-list" class="jobs-list" style="margin-top:12px"></div>
</section>

<script>
async function loadModels(){
  const res = await fetch('/api/models');
  const js = await res.json();
  const el = document.getElementById('models-list');
  el.innerHTML = '';
  for(const m of js.models){
    const div = document.createElement('div');
    div.className = 'job';
    div.innerHTML = `<strong>${m}</strong> <div style=\"float:right\"> <button data-name=\"${m}\" class=\"btn load-model\">Load</button> <button data-name=\"${m}\" class=\"btn ghost del-model\">Delete</button></div>`;
    el.appendChild(div);
  }
  document.querySelectorAll('.load-model').forEach(b=>b.addEventListener('click',async e=>{
    const name = e.target.dataset.name;
    const r = await fetch('/api/models/load',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});
    alert((await r.json()).status);
  }));
  document.querySelectorAll('.del-model').forEach(b=>b.addEventListener('click',async e=>{
    const name = e.target.dataset.name;
    if(!confirm('Delete model '+name+' ?')) return;
    const r = await fetch('/api/models/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});
    alert((await r.json()).status);
    loadModels();
  }));
}

document.getElementById('refresh-models').addEventListener('click',loadModels);
loadModels();
</script>

{% endblock %}
